import { PrismaClient } from "@prisma/client";

const prisma = new PrismaClient();

async function main() {
  console.log("üå± Seeding help articles...");

  // 1. Ajouter les donn√©es de r√©f√©rence pour les cat√©gories d'aide
  const helpCategories = [
    {
      key: "GAME_BASICS",
      label: "Bases du jeu",
      description: "Guides pour d√©buter dans Last War",
      sortOrder: 1,
      color: "#3B82F6",
    },
    {
      key: "STRATEGY",
      label: "Strat√©gies",
      description: "Strat√©gies avanc√©es et conseils tactiques",
      sortOrder: 2,
      color: "#059669",
    },
    {
      key: "ALLIANCE",
      label: "Alliance",
      description: "Tout sur la vie en alliance",
      sortOrder: 3,
      color: "#8B5CF6",
    },
    {
      key: "TRAINS",
      label: "Trains",
      description: "Syst√®me de trains d'alliance",
      sortOrder: 4,
      color: "#DC2626",
    },
    {
      key: "EVENTS",
      label: "√âv√©nements",
      description: "√âv√©nements du jeu et de l'alliance",
      sortOrder: 5,
      color: "#F59E0B",
    },
    {
      key: "TIPS_TRICKS",
      label: "Astuces",
      description: "Trucs et astuces utiles",
      sortOrder: 6,
      color: "#10B981",
    },
    {
      key: "FAQ",
      label: "Questions fr√©quentes",
      description: "R√©ponses aux questions courantes",
      sortOrder: 7,
      color: "#6B7280",
    },
    {
      key: "TUTORIAL",
      label: "Tutoriels",
      description: "Tutoriels pas √† pas",
      sortOrder: 8,
      color: "#EC4899",
    },
    {
      key: "ADVANCED",
      label: "Avanc√©",
      description: "Contenu pour joueurs exp√©riment√©s",
      sortOrder: 9,
      color: "#7C2D12",
    },
  ];

  for (const category of helpCategories) {
    await prisma.referenceData.upsert({
      where: {
        category_key: { category: "HELP_CATEGORY", key: category.key },
      },
      update: {},
      create: {
        category: "HELP_CATEGORY",
        key: category.key,
        label: category.label,
        description: category.description,
        color: category.color,
        sortOrder: category.sortOrder,
        isActive: true,
        isSystem: true,
      },
    });
  }

  // 2. Ajouter les statuts d'articles
  const helpStatuses = [
    {
      key: "DRAFT",
      label: "Brouillon",
      description: "Article en cours de r√©daction",
      sortOrder: 1,
      color: "#6B7280",
    },
    {
      key: "REVIEW",
      label: "En r√©vision",
      description: "Article en attente de r√©vision",
      sortOrder: 2,
      color: "#F59E0B",
    },
    {
      key: "PUBLISHED",
      label: "Publi√©",
      description: "Article publi√© et visible",
      sortOrder: 3,
      color: "#10B981",
    },
    {
      key: "ARCHIVED",
      label: "Archiv√©",
      description: "Article archiv√©",
      sortOrder: 4,
      color: "#EF4444",
    },
  ];

  for (const status of helpStatuses) {
    await prisma.referenceData.upsert({
      where: {
        category_key: { category: "HELP_STATUS", key: status.key },
      },
      update: {},
      create: {
        category: "HELP_STATUS",
        key: status.key,
        label: status.label,
        description: status.description,
        color: status.color,
        sortOrder: status.sortOrder,
        isActive: true,
        isSystem: true,
      },
    });
  }

  // 3. Tags d'aide pr√©d√©finis
  const helpTags = [
    {
      key: "DEBUTANT",
      label: "D√©butant",
      description: "Pour les nouveaux joueurs",
      sortOrder: 1,
      color: "#3B82F6",
    },
    {
      key: "AVANCE",
      label: "Avanc√©",
      description: "Pour les joueurs exp√©riment√©s",
      sortOrder: 2,
      color: "#7C2D12",
    },
    {
      key: "TUTORIEL",
      label: "Tutoriel",
      description: "Guide pas √† pas",
      sortOrder: 3,
      color: "#EC4899",
    },
    {
      key: "IMPORTANT",
      label: "Important",
      description: "Information cruciale",
      sortOrder: 4,
      color: "#DC2626",
    },
    {
      key: "RESSOURCES",
      label: "Ressources",
      description: "Gestion des ressources",
      sortOrder: 5,
      color: "#059669",
    },
    {
      key: "COMBAT",
      label: "Combat",
      description: "Strat√©gies de combat",
      sortOrder: 6,
      color: "#991B1B",
    },
    {
      key: "CONSTRUCTION",
      label: "Construction",
      description: "D√©veloppement de base",
      sortOrder: 7,
      color: "#92400E",
    },
    {
      key: "COORDINATION",
      label: "Coordination",
      description: "Travail d'√©quipe",
      sortOrder: 8,
      color: "#8B5CF6",
    },
  ];

  for (const tag of helpTags) {
    await prisma.referenceData.upsert({
      where: {
        category_key: { category: "HELP_TAG", key: tag.key },
      },
      update: {},
      create: {
        category: "HELP_TAG",
        key: tag.key,
        label: tag.label,
        description: tag.description,
        color: tag.color,
        sortOrder: tag.sortOrder,
        isActive: true,
        isSystem: true,
      },
    });
  }

  // Articles d'aide de d√©monstration
  const helpArticles = [
    {
      title: "Guide de d√©marrage - Bases du jeu",
      slug: "guide-demarrage-bases",
      content: `# Guide de d√©marrage Last War

Bienvenue dans Last War ! Ce guide vous aidera √† d√©buter dans le jeu.

## Premier lancement

Lorsque vous lancez le jeu pour la premi√®re fois :
- **Cr√©ez votre base** : Choisissez un nom unique
- **Suivez le tutoriel** : Ne sautez pas les √©tapes
- **Rejoignez une alliance** : Essentiel pour progresser

## Ressources de base

Les 4 ressources principales :
- **M√©tal** : Pour les b√¢timents et unit√©s
- **Huile** : Carburant pour les v√©hicules  
- **Cristaux** : Recherches avanc√©es
- **Argent** : Commerce et upgrades

### Conseils de gestion

- Prot√©gez vos ressources dans le bunker
- Collectez r√©guli√®rement vos productions
- Investissez dans l'am√©lioration des g√©n√©rateurs

## Premiers objectifs

1. Am√©liorer le Centre de Commandement niveau 10
2. Rejoindre une alliance active
3. Compl√©ter les missions quotidiennes
4. Participer aux √©v√©nements d√©butants`,
      excerpt:
        "Guide complet pour bien d√©buter dans Last War - ressources, alliance, premiers objectifs.",
      category: "GAME_BASICS",
      tags: ["d√©butant", "tutoriel", "ressources"],
      priority: 2,
      isFeatured: true,
      isPublished: true,
    },
    {
      title: "Strat√©gies de d√©veloppement de base",
      slug: "strategies-developpement-base",
      content: `# D√©veloppement optimis√© de votre base

## Priorit√©s de construction

### Phase 1 : Bases solides (CC 1-15)
- **Centre de Commandement** : Toujours en priorit√©
- **G√©n√©rateurs de ressources** : √âquilibrez les 4 types
- **Entrep√¥ts** : Prot√©gez vos ressources
- **Casernes** : Capacit√© d'arm√©e suffisante

### Phase 2 : Expansion (CC 16-25)
- **Centre de recherche** : Technologies cl√©s
- **H√¥pital** : R√©duire les pertes
- **Mur d'enceinte** : D√©fense de base
- **Arsenal** : Am√©lioration des √©quipements

## Technologies prioritaires

1. **√âconomie** : Production +20%
2. **Arm√©e** : Capacit√© et vitesse
3. **D√©fense** : R√©sistance aux attaques
4. **Alliance** : Bonus de coop√©ration

## Gestion des ressources

- **R√®gle 80/20** : 80% prot√©g√©, 20% disponible
- **Production continue** : Ne jamais arr√™ter
- **Commerce intelligent** : √âchangez vos surplus`,
      excerpt:
        "Optimisez le d√©veloppement de votre base avec ces strat√©gies √©prouv√©es.",
      category: "STRATEGY",
      tags: ["d√©veloppement", "base", "optimisation"],
      priority: 1,
      isFeatured: true,
      isPublished: true,
    },
    {
      title: "Guide des Trains d'Alliance",
      slug: "guide-trains-alliance",
      content: `# Syst√®me de Trains d'Alliance

## Qu'est-ce qu'un train ?

Un train d'alliance permet de **rassembler plusieurs membres** pour des attaques coordonn√©es contre des cibles puissantes.

## R√¥les dans un train

### Conducteur
- **Responsabilit√©s** : Dirige le train, choisit la cible
- **Pr√©requis** : Exp√©rience, niveau √©lev√©
- **Horaires** : 8h00, 14h00, 20h00

### Passagers  
- **Maximum** : 4 passagers par train
- **Participation** : Suivent les ordres du conducteur
- **R√©compenses** : Partag√©es selon la contribution

## Comment participer

1. **Consultez** la planification hebdomadaire
2. **Inscrivez-vous** aux cr√©neaux disponibles
3. **Pr√©parez** vos troupes et √©quipements
4. **Suivez** les instructions du conducteur

## Conseils pour r√©ussir

- **Communication** : Discord obligatoire
- **Ponctualit√©** : Soyez √† l'heure
- **Pr√©paration** : Troupes soign√©es et √©quip√©es
- **Coordination** : Attaquez ensemble`,
      excerpt:
        "Tout savoir sur le syst√®me de trains d'alliance pour maximiser vos gains.",
      category: "TRAINS",
      tags: ["trains", "alliance", "coordination"],
      priority: 1,
      isFeatured: false,
      isPublished: true,
    },
    {
      title: "√âv√©nements Alliance - Participation optimale",
      slug: "evenements-alliance-participation",
      content: `# Maximiser sa participation aux √©v√©nements

## Types d'√©v√©nements majeurs

### Guerre d'Alliance
- **Dur√©e** : 3 jours
- **Objectif** : D√©truire la base ennemie
- **Strat√©gie** : Coordination massive requise

### Combat de Boss
- **Fr√©quence** : Hebdomadaire  
- **R√©compenses** : √âquipements l√©gendaires
- **Tactique** : Attaques group√©es synchronis√©es

## Pr√©paration optimale

### Avant l'√©v√©nement
- Soigner toutes les troupes
- Pr√©parer les √©quipements
- Stocker les ressources n√©cessaires
- Coordonner avec l'alliance

### Pendant l'√©v√©nement
- Respecter les consignes
- Communiquer en temps r√©el
- Adapter sa strat√©gie
- Soutenir les alli√©s

## R√©compenses et progression

Les √©v√©nements offrent :
- **√âquipements rares**
- **Ressources bonus**
- **Points d'alliance**
- **Exp√©rience de commandant**`,
      excerpt: "Strat√©gies pour exceller dans tous les √©v√©nements d'alliance.",
      category: "EVENTS",
      tags: ["√©v√©nements", "strat√©gie", "r√©compenses"],
      priority: 0,
      isFeatured: false,
      isPublished: true,
    },
    {
      title: "FAQ - Questions fr√©quentes",
      slug: "faq-questions-frequentes",
      content: `# Questions fr√©quemment pos√©es

## G√©n√©ral

### Comment rejoindre l'alliance Frenchoy ?
Utilisez le code d'invitation fourni par un membre ou demandez sur Discord.

### Puis-je changer de serveur ?
Non, le changement de serveur n'est pas possible dans Last War.

### Comment r√©cup√©rer un compte perdu ?
Contactez le support avec vos informations de compte.

## Gameplay

### Mes troupes disparaissent, pourquoi ?
- V√©rifiez l'h√¥pital pour les bless√©s
- Consultez les rapports de combat
- Assurez-vous d'avoir de la nourriture

### Comment am√©liorer ma puissance rapidement ?
1. Am√©liorez les b√¢timents principaux
2. Recherchez les technologies
3. Entra√Ænez plus de troupes
4. √âquipez de meilleurs objets

### Quand puis-je participer aux trains ?
D√®s que vous atteignez le niveau 15 et rejoignez l'alliance.

## Alliance

### Comment obtenir plus d'aide d'alliance ?
- Aidez r√©guli√®rement les autres
- Participez aux √©v√©nements
- Soyez actif sur Discord

### Puis-je √™tre officier ?
Les promotions se basent sur l'activit√©, la fiabilit√© et l'anciennet√©.`,
      excerpt: "R√©ponses aux questions les plus courantes des membres.",
      category: "FAQ",
      tags: ["faq", "aide", "questions"],
      priority: 0,
      isFeatured: false,
      isPublished: true,
    },
  ];

  // Utiliser l'email admin de l'environnement
  const adminEmail = "admin@beben0.com";
  const adminId = "admin-seed-id";

  for (const article of helpArticles) {
    await prisma.helpArticle.upsert({
      where: { slug: article.slug },
      update: {
        title: article.title,
        content: article.content,
        excerpt: article.excerpt,
        category: article.category as any,
        tags: article.tags,
        priority: article.priority,
        isFeatured: article.isFeatured,
        isPublished: article.isPublished,
        publishedAt: article.isPublished ? new Date() : null,
      },
      create: {
        title: article.title,
        slug: article.slug,
        content: article.content,
        excerpt: article.excerpt,
        category: article.category as any,
        tags: article.tags,
        priority: article.priority,
        isFeatured: article.isFeatured,
        isPublished: article.isPublished,
        authorId: adminId,
        authorEmail: adminEmail,
        publishedAt: article.isPublished ? new Date() : null,
      },
    });
  }

  // Ajouter les permissions d'aide
  const helpPermissions = [
    { roleType: "ADMIN", permission: "view_help" },
    { roleType: "ADMIN", permission: "create_help_article" },
    { roleType: "ADMIN", permission: "edit_help_article" },
    { roleType: "ADMIN", permission: "delete_help_article" },
    { roleType: "ADMIN", permission: "publish_help_article" },
    { roleType: "ADMIN", permission: "manage_help_categories" },
    { roleType: "GUEST", permission: "view_help" },
  ];

  for (const perm of helpPermissions) {
    await prisma.rolePermission.upsert({
      where: {
        roleType_permission: {
          roleType: perm.roleType,
          permission: perm.permission,
        },
      },
      update: { isEnabled: true },
      create: {
        roleType: perm.roleType,
        permission: perm.permission,
        isEnabled: true,
      },
    });
  }

  console.log("‚úÖ Help articles seeded successfully!");
  console.log(`üìö Created ${helpArticles.length} help articles`);
  console.log(`üîê Added ${helpPermissions.length} help permissions`);
}

main()
  .catch((e) => {
    console.error("‚ùå Error seeding help articles:", e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
